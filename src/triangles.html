<!DOCTYPE html>
<html>
	<head lang="en=AU">
		<title>Freaky Dot Patterns</title>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8">
		<meta name="author" content="Patrick Toohey">
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<style>
		div {
			display: flex;
			justify-content: center;
			align-items: center;
		}
		canvas {
			position: absolute;
			top: 0px;
		}
	</style>
	<body>
		<script src="freakydots.js"></script>
		<script src="tween.js"></script>
		<script>
			
			// What we call chaos is just patterns we haven't recognized. 
			// What we call random is just patterns we can't decipher. 
			// What we can't understand we call nonsense. What we can't read we call gibberish.
			// There is no free will. 
			// There are no variables.
			const 
			freakFactors = {x: 40, y: 40},
			yourIrrationalFear = 250,
			secondsToTranscendance = 2.5,
			scopeOfYourFeeling = 1000,
			scaleOfYourResponse = 20;

			const 
			rotate = (field, colour, coords) => {
				field.paint(colour, scaleOfYourResponse);
				let x = (scopeOfYourFeeling + coords.x) * 0.5;
				let y = (scopeOfYourFeeling + coords.y) * 0.5;
				field.ctx.translate(x, y);
				field.ctx.rotate(coords.r);
				field.ctx.translate(-x, -y);
			},
			animate = (t) => {
				topDotsField.clear();
				requestAnimationFrame(animate);
				TWEEN.update(t);
			}

			const 
			coords = {x:0, y: 0, r: 0},
			tween = new TWEEN.Tween(coords)
				.to({x: freakFactors.x, y: freakFactors.y, r: Math.PI / yourIrrationalFear}, secondsToTranscendance * 1000)
				//.easing(TWEEN.Easing.Sinusoidal.InOut)
				.onUpdate(() => {
					rotate(topDotsField, 'rgb(0, 0, 0)', coords);
				})
				.repeat(Infinity)
				.yoyo(false)
				.start();

			let 
			topDotsField = new DotField(new Rect(0, 0, scopeOfYourFeeling, scopeOfYourFeeling)),
			bottomDotsField = topDotsField.clone();

			let holder = document.body.appendChild(document.createElement('div'));

			holder.append(topDotsField.canvas);
			holder.append(bottomDotsField.canvas);

			topDotsField.canvas.style.clipPath = 
			bottomDotsField.canvas.style.clipPath = 'circle(' + scopeOfYourFeeling/3 + 'px at center)';

			bottomDotsField.paint('rgb(0, 0, 0)', scaleOfYourResponse);
			requestAnimationFrame(animate);

		</script>
	</body>
</html>